MY_PATH=~/DEV.19/GITHUB/orbiter
MY_PATH2=~/DEV.19/GITHUB/orbiter2
#MY_PATH=/scratch3/betten/COMPILE/2018_05_26
#MY_PATH2=/scratch3/betten/COMPILE/2018_05_26
SRC=$(MY_PATH)/ORBITER/src
SRC2=$(MY_PATH2)/ORBITER2/src

PACKINGS_PATH=$(SRC2)/PACKINGS
REGULAR_PACKING_PATH=$(SRC2)/REGULAR_PACKING
GRASSMANN_PATH=$(SRC2)/GRASSMANN
ALGEBRA_PATH=$(SRC)/apps/algebra
TOOLS_PATH=$(SRC)/apps/tools
COMBINATORICS_PATH=$(SRC)/apps/combinatorics
PROJECTIVE_SPACE_PATH=$(SRC)/apps/projective_space
MATH161_PATH=$(SRC2)/MATH161


ORDER=16
Q=4
DEPTH=3
POLY=

ARGUMENTS= -order $(ORDER) -dim_over_kernel 2 -recoordinatize \
		-base_fname partial_packings_$(Q)_$(K)_ \
		-input_prefix ./STARTER_SPREADS/ \
		-output_prefix ./SYSTEMS/ \
		-solution_prefix ./SOLUTIONS/ \
		-starter_size $(DEPTH) 


# group 0 give  27924 iso types with 1 fixpoint

# group 1 gives 216 iso types with 6 fixpoints

# group 2 gives 3732 iso types with 1 fixpoint


# total 31872



get_poly:
	$(ALGEBRA_PATH)/get_poly.out -v 2 -primitive 4 4

# problems with -irred 4 4

classes:
	- $(PACKINGS_PATH)/packing_main.out -v 6 $(ARGUMENTS) \
		-conjugacy_classes
	pdflatex PGGL_4_4conjugacy_classes.tex 
	open PGGL_4_4conjugacy_classes.pdf

classes_and_normalizers:
	- $(PACKINGS_PATH)/packing_main.out -v 6 $(ARGUMENTS) \
		-conjugacy_classes_and_normalizers
	pdflatex PGGL_4_4conjugacy_classes_and_normalizers.tex 
	open PGGL_4_4conjugacy_classes_and_normalizers.pdf


# elements of order 2:
# conjugacy class reps:
# elt order, class size, centralizer order 

#2 48960 40320

#2 5355 368640

#2 64260 30720


normalform:
	$(ALGEBRA_PATH)/eigenstuff.out -q 4 -M 4 "1,0,0,0, 0,1,0,0, 1,1,1,0, 0,3,0,1"

# problem!


CLASS_2A=-centralizer_of_element "1,0,0,0, 0,1,0,0, 0,0,1,0, 0,0,0,1, 1" -label "2A"
CLASS_2B=-centralizer_of_element "1,0,0,0, 1,1,0,0, 0,0,1,0, 0,0,0,1, 0" -label "2B"
CLASS_2C=-centralizer_of_element "1,0,0,0, 1,1,0,0, 0,0,1,0, 0,0,1,1, 0" -label "2C"

centralizer2A:
	$(PACKINGS_PATH)/packing_main.out -v 6 $(ARGUMENTS) $(CLASS_2A)

centralizer2B:
	$(PACKINGS_PATH)/packing_main.out -v 6 $(ARGUMENTS) $(CLASS_2B)
		
centralizer2C:
	$(PACKINGS_PATH)/packing_main.out -v 6 $(ARGUMENTS) $(CLASS_2C)
	


prepare:
	- $(PACKINGS_PATH)/packing_main.out -v 6 $(ARGUMENTS) \
		-prime_at_a_time 2 0

#We found 2549064 orbits of the selected group
#Written file packing_q4_go2_g0_orbits.bin of size 163099834
#prime_at_a_time::test_orbits We found 92400 orbits which are partial packings
#Written file packing_q4_go2_g0_orbits_table.cvs of size 1427125
#prime_at_a_time::test_orbits The distribution of orbit lengths is: 1^1680, 2^90720
#i : type[i] : number of orbits
#0 : 1 : 1680
#1 : 2 : 90720
#Number of fixedpoints = 1680
#prime_at_a_time::create_graph_on_fixpoints creating the graph on fixpoints
#prime_at_a_time::create_graph nb_points=1680
#Written file packing_q4_go2_g0_fixpoint_graph.bin of size 189747
#time: 28:23


#packing_q4_go2_g0_orbits_table.cvs
# list the 92400 orbits of packings under G_\phi which are good. 
# 1680 of them have orbit length 1 (the short orbits)
# 90720 of them have orbit length 2 (the long orbits)

G2Aall_cliques:
	$(TOOLS_PATH)/all_cliques.out -v 2 \
		-file packing_q4_go2_g0_fixpoint_graph.bin \
		-all_cliques -print_level 7


#i : number of orbits of cliques of the fixedpoint graph of size i
#0 : 1
#1 : 1
#2 : 15
#3 : 508
#4 : 4334
#5 : 6656
#6 : 2379
#7 : 220
#8 : 0
#9 : 0
#Written file reps_at_level_6.txt of size 52181
#Written file reps_at_level_7.txt of size 5759



fp_cliques:
	- $(PACKINGS_PATH)/packing_main.out -v 6 $(ARGUMENTS) \
		-cliques_on_fixpoint_graph 2 0 7

#			group_order = atoi(argv[++i]);
#			group_idx = atoi(argv[++i]);
#			clique_size = atoi(argv[++i]);
#compute_orbits_on_subsets done
#depth : number of orbits
#0 : 1
#1 : 2
#2 : 27
#3 : 1016
#4 : 8663
#5 : 13312
#6 : 4758
#7 : 440
#prime_at_a_time::compute_cliques_on_fixpoint_graph after compute_orbits_on_subsets
#generator::get_orbit_representatives
#orbits_on_k_sets: we found 440 orbits on 7-sets
#generator::get_orbit_representatives done
#We found 440 orbits of cliques of size 7 in the fixed point graph:
#   0    3    6  270  318  392 1592 
#...
#   1   98  102  537  538 1655 1674 
#prime_at_a_time::compute_cliques_on_fixpoint_graph done
#packing::cliques_on_fixpoint_graph done
#after P->cliques_on_fixpoint_graph
#isomorph_arguments::execute
#isomorph_arguments::execute done
#***************** The End **********************
#11:13


#packing_q4_go2_g0_fp_cliques_lvl_7
# the first clique:
#7 0 3 6 270 318 392 1592 2 agaaaaaaabaaaaaaaaaaaaaaabaaaaaaacaaaaaaadaaaaaaaeaaaaaaagaaaaaaabaaaaaaabaaaaaaabaaaaaaabaaaaaaabaaaaaaacaaaaaaabaebaeaab

read_fp:
	$(TOOLS_PATH)/read_orbiter_file.out -v 2 -file packing_q4_go2_g0_fp_cliques_lvl_7 \
		-save summary_fix_structures.csv



G2AT:
	- $(PACKINGS_PATH)/packing_main.out -v 6 $(ARGUMENTS) \
		-type_of_fixed_spreads 2 0 7

#			group_order = atoi(argv[++i]);
#			group_idx = atoi(argv[++i]);
#			clique_size = atoi(argv[++i]);


#packing_q4_go2_g0_fp_cliques_lvl_7
#-1 440 27779 in 10:29(42^4, 6^{50}, 2^{386}) average is 2 + 360 / 440

#types of cliques:
#$$
#\begin{array}{*{3}{c}}
#\hline
#\mbox{Type} & \# \, \mbox{Orbits} & \mbox{Stabilizer Orders} \\
#\hline
#\hline 
#( 0, 0, 1 ) & 440 & 42^4,\,6^{50},\,2^{386}\\
#\hline
#\end{array}
#$$

graphs:
	- $(PACKINGS_PATH)/packing_main.out -v 6 $(ARGUMENTS) \
		-process_long_orbits 2 0 7 0 1 2 7

#			group_order = atoi(argv[++i]);
#			group_idx = atoi(argv[++i]);
#			clique_size = atoi(argv[++i]);
#			clique_no_r = atoi(argv[++i]);
#			clique_no_m = atoi(argv[++i]);
#			long_orbit_length = atoi(argv[++i]);
#			long_orbits_clique_size = atoi(argv[++i]);

#Number of long orbits = 6696

#Written file graph_long_packing_q4_go2_g0_2_7_0.bin of size 2855438

Gcollect:
	$(TOOLS_PATH)/collect.out -v 2 -graph_number_of_vertices \
		-fname_in_mask  packing_q4_go2_g0_csz7_cno%ld_graph.bin \
		-N 440  -save summary_N.csv  Nb_vertices



C0:
	$(TOOLS_PATH)/all_cliques.out -v 2 \
		-file packing_q4_go2_g0_csz7_cno0_graph.bin \
		-all_cliques_of_size 7 packing_q4_go2_g0_csz7_cno0_graph_solutions.txt \
		-print_level 7 \
		-save_incma_in_and_out



#Written file graph_long_packing_q4_go2_g0_2_7_0_solutions.txt of size 29237
#nb_sol = 816
#decision_step_counter = 106362954
#0:17


Cparallel:
	- mkdir LOG
	$(TOOLS_PATH)/scheduler.out \
		-v 2 \
		-input_file_mask packing_q4_go2_g0_csz7_cno%ld_graph.bin \
		-target_file_mask packing_q4_go2_g0_csz7_cno%ld_graph_solutions.txt \
		-log_prefix LOG/ \
		-N 440 \
		-J 48 \
		-command_mask  "$(TOOLS_PATH)/all_cliques.out -v 2 -file packing_q4_go2_g0_csz7_cno%ld_graph.bin -all_cliques_of_size 7 packing_q4_go2_g0_csz7_cno%ld_graph_solutions.txt -print_level 7" \
		-reload




X0:
	- $(PACKINGS_PATH)/packing_main.out -v 6 $(ARGUMENTS) \
		-expand_cliques_of_long_orbits 2 0 7 0 10000 2 7


#written file packing_q4_go2_g0_csz7_cno0_packings.csv of size 134604
#0:48


Xparallel:
	- mkdir LOG_X
	$(TOOLS_PATH)/scheduler.out \
		-v 2 \
		-input_file_mask packing_q4_go2_g0_csz7_cno%ld_graph_solutions.txt \
		-target_file_mask packing_q4_go2_g0_csz7_cno%ld_packings.csv \
		-log_prefix LOG_X/ \
		-N 440 \
		-J 48 \
		-command_mask  "$(PACKINGS_PATH)/packing_main.out -v 6 $(ARGUMENTS) -expand_cliques_of_long_orbits 2 0 7 %ld 10000 2 7" \
		-reload


collect:
	$(TOOLS_PATH)/collect.out -v 2 -fname_in_mask  packing_q4_go2_g0_csz7_cno%ld_packings.csv \
		-N 440 \
		-save summary_nb_sol.csv Nb_sol



#classification:
#816^96, 774^140, 592^4, 578^152, 336^28, 192^20



I0:
	$(PROJECTIVE_SPACE_PATH)/projective_space_main.out -v 2 -n 3 -q 4 \
		-file_of_packings_through_spread_table \
			packing_q4_go2_g0_csz7_cno0_packings.csv \
			Spread_table.csv \
		-classify_nauty \
		-prefix I0 \
		-save I0 



I0m:
	$(PROJECTIVE_SPACE_PATH)/projective_space_main.out -v 2 -n 3 -q 4 \
		-file_of_packings_through_spread_table \
			packing_q4_go2_g0_csz7_cno0_packings_modified.csv \
			Spread_table.csv \
		-classify_nauty \
		-prefix I0 \
		-save I0 \
		-fixed_structure_of_element_of_order 2




Iparallel:
	- mkdir LOG_I
	$(TOOLS_PATH)/scheduler.out \
		-v 2 \
		-input_file_mask packing_q4_go2_g0_csz7_cno%ld_packings.csv \
		-target_file_mask I%ld_iso.csv \
		-log_prefix LOG_I/ \
		-N 440 \
		-J 48 \
		-command_mask  "$(PROJECTIVE_SPACE_PATH)/projective_space_main.out -v 2 -n 3 -q 4 -file_of_packings_through_spread_table packing_q4_go2_g0_csz7_cno%ld_packings.csv Spread_table.csv -classify_nauty -prefix I%ld -save I%ld" \
		-reload



#Written file graph_long_packing_q4_go2_g0_2_7_0_solutions.txt of size 29237
#nb_sol = 816
#decision_step_counter = 106362954



Icollect:
	$(TOOLS_PATH)/collect.out -v 2 -fname_in_mask  I%ld_iso.txt -N 440 \
		-save summary_iso.csv Nb_iso

# change to I%ld_iso.csv if you don't want ago info

#classification:
#816^96, 774^112, 592^4, 578^152, 336^8, 258^28, 192^14, 112^16, 64^6, 16^4
# total: 270088
# all have ago = 2.


C1:
	$(TOOLS_PATH)/all_cliques.out -v 2 \
		-file packing_q4_go2_g0_csz7_cno1_graph.bin \
		-all_cliques_of_size 7 packing_q4_go2_g0_csz7_cno1_graph_solutions.txt \
		-print_level 7


join:
	$(MATH161_PATH)/join.out -v 2 -join summary_fix_structures.csv Node \
		-join  summary_N.csv Case \
		-join  summary_nb_sol.csv Case \
		-join  summary_iso.csv Case \
		-sort "Stab order" \
		-save summary_join.csv 


#have to manually add 
#END
#at the end of the file summary_join.csv

DN:
	$(TOOLS_PATH)/distribution.out -v 2 \
		-file summary_join.csv "Stab order" \
		-secondary "Nb_vertices"

DNb_sol:
	$(TOOLS_PATH)/distribution.out -v 2 \
		-file summary_join.csv "Stab order" \
		-secondary "Nb_sol"

Diso:
	$(TOOLS_PATH)/distribution.out -v 2 \
		-file summary_join.csv "Stab order" \
		-secondary "Nb_iso"

################################################################################


