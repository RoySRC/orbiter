#MY_PATH=../../../DEV.18/GITHUB/orbiter
#MY_PATH=/projects/abetten@colostate.edu/COMPILE/2018_03_11
#MY_PATH2=../../../DEV.18
#MY_PATH=../../../DEV.18
MY_PATH=/scratch3/betten/COMPILE/2018_03_12
MY_PATH2=/scratch3/betten/COMPILE/2018_03_12
SRC=$(MY_PATH)/ORBITER/SRC
SRC2=$(MY_PATH2)/ORBITER2/SRC2

BLT_PATH=$(SRC)/BLT
SEMIFIELD_PATH=$(SRC2)/SEMIFIELD
GRASSMANN_PATH=$(SRC2)/GRASSMANN
TOOLS_PATH=$(SRC)/APPS/TOOLS


nothing:



create_jobs:
	$(TOOLS_PATH)/create_file.out -file_mask job%03ld \
		-N 256 \
		-line "#!/bin/bash" \
		-line "#SBATCH -J job%03ld" \
		-line "#SBATCH -p shas" \
		-line "#SBATCH --qos normal" \
		-line "#SBATCH -t 24:00:00" \
		-line "#SBATCH -N 1" \
		-line "#SBATCH --mem 20000" \
		-line "mkdir /scratch/summit/abetten@colostate.edu/BLT.18/71/%03ld" \
		-line "mkdir /scratch/summit/abetten@colostate.edu/BLT.18/71/%03ld/G" \
		-line "/projects/abetten@colostate.edu/COMPILE/2018_03_10/ORBITER/SRC/APPS/BLT/blt_main.out -v 2 -BLT -q 71 -starter_size 5 -input_prefix /projects/abetten@colostate.edu/BLT.18/Q71/STARTER_DIR/ -output_prefix /scratch/summit/abetten@colostate.edu/BLT.18/71/%03ld/SYSTEMS/ -solution_prefix /scratch/summit/abetten@colostate.edu/BLT.18/71/%03ld/SOLUTIONS/ -base_fname BLT_71 -create_graphs %ld 256 4 -lex -output_prefix /scratch/summit/abetten@colostate.edu/BLT.18/71/%03ld/G/" 



#/SRC/APPS/BLT/blt_main.out -v %ld -BLT -q %ld -starter_size 5 -input_prefix STARTER_DIR/ -output_prefix SYSTEMS/ -solution_prefix SOLUTIONS/ -base_fname BLT_%ld -create_graphs %ld %ld 4 -lex -output_prefix G/", orbiter_path, verbose_level_run, q, q, slice_r, slice_m

join:
	$(TOOLS_PATH)/join_sets.out -v 2 \
		-N 256 \
		-file_mask /scratch/summit/abetten@colostate.edu/BLT.18/71/%03ld/G/list_of_cases_BLT_71_5_%ld_256.txt \
		-out_mask /scratch/summit/abetten@colostate.edu/BLT.18/71/%03ld/G/graph_BLT_71_5_%ld.bin \
		-save graphs.csv



prepare:
	$(TOOLS_PATH)/create_file.out -v 2 \
		-read_cases_text graphs.csv 3 4 \
		-file_mask job%04ld \
		-N 2048 \
		-line "#!/bin/bash" \
		-line "#SBATCH -J job%04ld" \
		-line "#SBATCH -p shas" \
		-line "#SBATCH --qos normal" \
		-line "#SBATCH -t 24:00:00" \
		-line "#SBATCH -N 1" \
		-line "#SBATCH --output=/scratch/summit/abetten@colostate.edu/BLT.18/71/OUTPUT/slurm-%%j.out" \
		-tasks 12 "#SBATCH --ntasks-per-node=%ld" \
		-command  "/projects/abetten@colostate.edu/COMPILE/2018_03_11/ORBITER/SRC/APPS/TOOLS/all_rainbow_cliques.out -v 2 -output_file /scratch/summit/abetten@colostate.edu/BLT.18/71/SOLUTIONS/BLT_71_solutions_%04ld_%02ld.txt -input_list_of_files " \
		-final_line "wait" 


missing_0:
	$(TOOLS_PATH)/missing_files.out -v 2 -N 250 -N2 12 \
		-mask SOLUTIONS/0/BLT_71_solutions_%04ld_%02ld_stats.csv \
		-save missing_0.csv

missing_250:
	$(TOOLS_PATH)/missing_files.out -v 2 -N 1250 -N_min 250 -N2 12 \
		-mask SOLUTIONS/250/BLT_71_solutions_%04ld_%02ld_stats.csv \
		-save missing_250.csv

missing_3:
	$(TOOLS_PATH)/missing_files.out -v 2 -N 2048 -N_min 1250 -N2 12 \
		-mask SOLUTIONS/3/BLT_71_solutions_%04ld_%02ld_stats.csv \
		-save missing_3.csv


cat_0:
	- mkdir SOLUTIONS/0_COLLECTED
	$(TOOLS_PATH)/concatenate_files.out -v 2 -N 12 -loop 0 249 \
		-fname_in_mask SOLUTIONS/0/BLT_71_solutions_%04ld_%%02ld_stats.csv \
		-save SOLUTIONS/0_COLLECTED/BLT_71_solutions_%04ld_stats.csv \
		-EOF_marker END \
		-title_line 
	$(TOOLS_PATH)/concatenate_files.out -v 2 -N 12 -loop 0 249 \
		-fname_in_mask SOLUTIONS/0/BLT_71_solutions_%04ld_%%02ld.txt \
		-save SOLUTIONS/0_COLLECTED/BLT_71_solutions_%04ld.txt \
		-EOF_marker -1

cat_250:
	- mkdir SOLUTIONS/250_COLLECTED
	$(TOOLS_PATH)/concatenate_files.out -v 2 -N 12 -loop 250 1249 \
		-fname_in_mask SOLUTIONS/250/BLT_71_solutions_%04ld_%%02ld_stats.csv \
		-save SOLUTIONS/250_COLLECTED/BLT_71_solutions_%04ld_stats.csv \
		-EOF_marker END \
		-title_line 
	$(TOOLS_PATH)/concatenate_files.out -v 2 -N 12 -loop 250 1249 \
		-fname_in_mask SOLUTIONS/250/BLT_71_solutions_%04ld_%%02ld.txt \
		-save SOLUTIONS/250_COLLECTED/BLT_71_solutions_%04ld.txt \
		-EOF_marker -1

cat_3:
	- mkdir SOLUTIONS/3_COLLECTED
	$(TOOLS_PATH)/concatenate_files.out -v 2 -N 12 -loop 1250 2047 \
		-fname_in_mask SOLUTIONS/3/BLT_71_solutions_%04ld_%%02ld_stats.csv \
		-save SOLUTIONS/3_COLLECTED/BLT_71_solutions_%04ld_stats.csv \
		-EOF_marker END \
		-title_line 
	$(TOOLS_PATH)/concatenate_files.out -v 2 -N 12 -loop 1250 2047 \
		-fname_in_mask SOLUTIONS/3/BLT_71_solutions_%04ld_%%02ld.txt \
		-save SOLUTIONS/3_COLLECTED/BLT_71_solutions_%04ld.txt \
		-EOF_marker -1

cat_all:
	$(TOOLS_PATH)/concatenate_files.out -v 2 -N 2048 \
		-fname_in_mask SOLUTIONS/ALL/BLT_71_solutions_%04ld_stats.csv \
		-save SOLUTIONS/BLT_71_solutions_all_stats.csv \
		-EOF_marker END \
		-title_line 
	$(TOOLS_PATH)/concatenate_files.out -v 2 -N 2048 \
		-fname_in_mask SOLUTIONS/ALL/BLT_71_solutions_%04ld.txt \
		-save SOLUTIONS/BLT_71_solutions_all.txt \
		-EOF_marker -1


build_db:
	$(BLT_PATH)/blt_main.out -v 2 -BLT -q 71 -starter_size 5 -input_prefix STARTER_DIR/ -output_prefix SYSTEMS/ -solution_prefix SOLUTIONS/ -base_fname BLT_71 -build_db


read_solutions:
	$(BLT_PATH)/blt_main.out -v 2 -BLT -q 71 -starter_size 5 -input_prefix STARTER_DIR/ -output_prefix SYSTEMS/ -solution_prefix SOLUTIONS/ -base_fname BLT_71 -read_solutions_from_clique_finder 


compute_orbits:
	$(BLT_PATH)/blt_main.out -v 2 -BLT -q 71 -starter_size 5 -input_prefix STARTER_DIR/ -output_prefix SYSTEMS/ -solution_prefix SOLUTIONS/ -base_fname BLT_71 -compute_orbits


isomorph:
	$(BLT_PATH)/blt_main.out -v 2 -BLT -q 71 -starter_size 5 -input_prefix STARTER_DIR/ -output_prefix SYSTEMS/ -solution_prefix SOLUTIONS/ -base_fname BLT_71 -isomorph_testing -print_interval 250





