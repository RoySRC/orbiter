#MY_PATH=../../../DEV.14
#SRC=$(MY_PATH)/ORBITER/SRC
#SRC2=$(MY_PATH)/ORBITER2/SRC2
MY_PATH=/scratch/betten/COMPILE/2014_10_10
SRC=$(MY_PATH)/ORBITER/SRC
SRC2=$(MY_PATH)/ORBITER2/SRC2

PACKINGS_PATH=$(SRC2)/PACKINGS
TRANSLATION_PLANE_PATH=$(SRC2)/TRANSLATION_PLANE
GRASSMANN_PATH=$(SRC2)/GRASSMANN
DIOPHANT_PATH=$(SRC)/DIOPHANT
MATH161_PATH=$(SRC2)/MATH161
COMBINATORICS_PATH=$(SRC2)/COMBINATORICS


ORDER=9
Q=3
STARTER_DEPTH=3
DEPTH=6
POLY=


starter:
	- mkdir SYSTEMS
	$(PACKINGS_PATH)/packing_main.out -v 5 \
		-order $(ORDER) -dim_over_kernel 2 -W \
		-starter_directory_name STARTER_SPREADS \
		-starter_prefix spreads_$(Q)_ \
		-prefix SYSTEMS/ \
		-starter $(STARTER_DEPTH)



# Aug 9, 2014 on domino: level 3: 1274 orbits in 10 sec



lift:
	- mkdir SYSTEMS
	$(PACKINGS_PATH)/packing_main.out -v 2 \
		-order $(ORDER) -dim_over_kernel 2 -W \
		-starter_directory_name STARTER_SPREADS \
		-starter_prefix spreads_$(Q)_ \
		-prefix SYSTEMS/ \
		-lift $(STARTER_DEPTH) ./STARTER_SPREADS/ \
		-lex \
		-solve 


#-lex


# Aug 9, 2014 on domino: with -lex    12 min 29 sec
# Aug 9, 2014 on domino: with -lex 8342028 solutions  in 12 min 35 sec
# Nov 9, 2013 on MacBook Pro:    8342028 solutions in 17 min 2 sec
# Nov 9, 2013 on domino:    8342028 solutions in 12 min 27 sec


build_db:
	$(PACKINGS_PATH)/packing_main.out -v 2 \
		-order $(ORDER) -dim_over_kernel 2 -W \
		-starter_directory_name STARTER_SPREADS \
		-starter_prefix spreads_$(Q)_ \
		-build_db $(STARTER_DEPTH) 

# Oct 10, 2014 on domino: 6 sec
# Aug 9, 2014 on domino: 6 sec

		
read_solutions:
	$(PACKINGS_PATH)/packing_main.out -v 2 \
		-order $(ORDER) -dim_over_kernel 2 -W \
		-starter_directory_name STARTER_SPREADS \
		-starter_prefix spreads_$(Q)_ \
		-read_solution_files $(STARTER_DEPTH) SOLUTIONS/spreads_3__depth_3_solutions.txt

# Oct 12, 2014 on domino:    5 hrs 28 min 33 sec
# Nov 9, 2013 on domino:    5 hrs 27 min 36 sec
		

compute_orbits:
	$(PACKINGS_PATH)/packing_main.out -v 2 \
		-order $(ORDER) -dim_over_kernel 2 -W \
		-starter_directory_name STARTER_SPREADS \
		-starter_prefix spreads_$(Q)_ \
		-compute_orbits $(STARTER_DEPTH) 


# Nov 9, 2013 on domino:    14 min 39 sec



isomorph_testing:
	$(PACKINGS_PATH)/packing_main.out -v 2 \
		-order $(ORDER) -dim_over_kernel 2 -W \
		-starter_directory_name STARTER_SPREADS \
		-starter_prefix spreads_$(Q)_ \
		-isomorph_testing $(STARTER_DEPTH) 


# Nov 20, 2013 on domino:    9 days 20 hrs 54 min 51 sec
#We found 73343 isomorphism types


klein:
	$(PACKINGS_PATH)/packing_main.out -v 2 \
		-order $(ORDER) -dim_over_kernel 2 -W \
		-starter_directory_name STARTER_SPREADS \
		-starter_prefix spreads_$(Q)_ \
		-klein $(STARTER_DEPTH) 

report:
	$(PACKINGS_PATH)/packing_main.out -v 2 \
		-order $(ORDER) -dim_over_kernel 2 -W \
		-starter_directory_name STARTER_SPREADS \
		-starter_prefix spreads_$(Q)_ \
		-report $(STARTER_DEPTH) 

down:
	$(PACKINGS_PATH)/packing_main.out -v 2 \
		-order $(ORDER) -dim_over_kernel 2 -W \
		-starter_directory_name STARTER_SPREADS \
		-starter_prefix spreads_$(Q)_ \
		-down_orbits $(STARTER_DEPTH) 



######################################################





# writes ISO/orbits_of_stabilizer.csv

isomorph:
	$(TRANSLATION_PLANE_PATH)/tp.out -v 2 \
		-W -order $(ORDER) -dim_over_kernel 2 \
		-print_interval 10000 \
		-extend_regulus 3 \
		-isomorph_testing 3 




#klein:
#	$(TRANSLATION_PLANE_PATH)/tp.out -v 2 \
#		-W -order $(ORDER) -dim_over_kernel 2 \
#		-extend_regulus 3 \
#		-klein 





#report:
#	$(TRANSLATION_PLANE_PATH)/tp.out -v 2 \
#		-W -order $(ORDER) -dim_over_kernel 2 \
#		-extend_regulus 3 \
#		-report  



undistinguish:
	$(TRANSLATION_PLANE_PATH)/tp.out -v 2 \
		-W -order $(ORDER) -dim_over_kernel 2 \
		-extend_regulus 3 \
		-undistinguish_regulus  



report_spreads:
	$(TRANSLATION_PLANE_PATH)/tp.out -v 4 \
		-W -order $(ORDER) -dim_over_kernel 2 \
		-extend_regulus 3 \
		-report_spreads  



######

packing:
	$(TRANSLATION_PLANE_PATH)/tp.out -v 4 \
		-W -order $(ORDER) -dim_over_kernel 2 \
		-extend_regulus 3 \
		-packing  4 \
		-make_cases \
		-split -1 1

p0:
	nohup nice $(TRANSLATION_PLANE_PATH)/tp.out -v 4 \
		-W -order $(ORDER) -dim_over_kernel 2 \
		-extend_regulus 3 \
		-make_packing  \
		-split 0 4 

p1:
	nohup nice $(TRANSLATION_PLANE_PATH)/tp.out -v 4 \
		-W -order $(ORDER) -dim_over_kernel 2 \
		-extend_regulus 3 \
		-make_packing  \
		-split 1 4 

p2:
	nohup nice $(TRANSLATION_PLANE_PATH)/tp.out -v 4 \
		-W -order $(ORDER) -dim_over_kernel 2 \
		-extend_regulus 3 \
		-make_packing  \
		-split 2 4 

p3:
	nohup nice $(TRANSLATION_PLANE_PATH)/tp.out -v 4 \
		-W -order $(ORDER) -dim_over_kernel 2 \
		-extend_regulus 3 \
		-make_packing  \
		-split 3 4 


plot_cases:
	$(MATH161_PATH)/plot_distribution.out -v 2 -column orbits_of_stabilizer.csv Stab_orbits \
		-output_fname plot_nb_orbits \
			-label_x Cases \
			-out_of 1500 \
			-log_v 100 \
			-v_ticks 10 \
			-switch_x

plot_col:
	$(MATH161_PATH)/plot_distribution.out -v 2 -column nb_col.csv Nb_col \
		-output_fname plot_nb_col \
			-label_x Cases \
			-out_of 500 \
			-v_ticks 10 \
			-switch_x


plot_down_special:
	$(MATH161_PATH)/plot_distribution.out -v 2 \
		-column Nb_down_orbits.csv C1 \
		-output_fname plot_nb_orbits_down_special \
			-label_x Packings \
			-out_of 100 \
			-v_ticks 10 \
			-switch_x

plot_down:
	$(MATH161_PATH)/plot_distribution.out -v 2 \
		-column Nb_down_orbits.csv C0 \
		-output_fname plot_nb_orbits_down \
			-label_x Packings \
			-out_of 1000 \
			-v_ticks 10 \
			-switch_x

plot_down_both:
	$(MATH161_PATH)/plot_distribution.out -v 2 \
		-column Nb_down_orbits.csv C0 \
		-column Nb_down_orbits.csv C1 \
		-output_fname plot_nb_orbits_down_both \
			-label_x Packings \
			-out_of 1000 \
			-v_ticks 10 \
			-log_v 100 \
			-switch_x


decomp:
	$(COMBINATORICS_PATH)/plot_decomposition_matrix.out -v 2 \
		-file1 orbits_of_stabilizer.csv \
		-file2 Down_identify.csv \
		-file3 staborbits.txt \
		-x 4000 \
		-y 4000 \
		-output_fname decomp \
		-split_v 50000
	mpost decomp_0.mp
	mpost decomp_1.mp
	mpost decomp_2.mp
	mpost decomp_3.mp
	mpost decomp_4.mp

conv:
	/sw/bin/convert -density 600x600 -trim view.ps decomp.jpg

#####################3

print:
	$(TRANSLATION_PLANE_PATH)/tp.out -v 2 \
		-W -order $(ORDER) -dim_over_kernel 2 \
		-extend_regulus 3 \
		-print 3


print_44:
	$(TRANSLATION_PLANE_PATH)/tp.out -v 2 \
		-W -order $(ORDER) -poly 13 \
		-dim_over_kernel 2 \
		-extend_regulus 3 \
		-print 3 \
		-select 44 1

move:
	mv extend_regulus_8__reps.txt Reps_rep.txt
	mv extend_regulus_8__stab.bin Reps_stabgens.bin
	mv extend_regulus_8__fusion.txt Reps_fusion.txt
	mv extend_regulus_8__fusion_ge.bin Reps_fusion_ge.bin




#################





solve_0:
	$(DIOPHANT_PATH)/solve.out -v 2 -steiner 68 -mckay -sol problem_0.txt 



search_lex_c:
	$(TRANSLATION_PLANE_PATH)/tp_extend.out -v 6 \
			-order $(ORDER) -dim_over_kernel 2 \
			-lex \
			-read_candidates_file spread_$(ORDER)_lvl_$(DEPTH)_candidates.txt \
			$(DEPTH) 0 1000000



#			-write_graph_file \


