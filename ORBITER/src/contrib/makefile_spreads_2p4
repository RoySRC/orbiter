MY_PATH=~/DEV.18/GITHUB/orbiter
MY_PATH2=~/DEV.18
SRC=$(MY_PATH)/ORBITER/SRC
SRC2=$(MY_PATH2)/ORBITER2/SRC2

SPREAD_PATH=$(SRC)/APPS/SPREAD
TOOLS_PATH=$(SRC)/APPS/TOOLS
ANDRE_PATH=$(SRC2)/ANDRE
GRASSMANN_PATH=$(SRC2)/GRASSMANN
TREEDRAW_PATH=$(SRC2)/TREEDRAW
PROJECTIVE_SPACE_PATH=$(SRC)/APPS/PROJECTIVE_SPACE
ALGEBRA_PATH=$(SRC2)/ALGEBRA


Q=2
K=4
ORDER=16
ORDER_PLUS_ONE=17
DEPTH=5
POLY=



# iso : label : ago
# 0 : JOWK : 1008
# 1 : LMRH : 1008 
# 2 : SEMI4 : 1728
# 3 : DSFP : 216 
# 4 : DEMP : 360
# 5 : SEMI2 : 288
# 6 : HALL : 3600
# 7 : PG(2,16) : 244800 (stabilizer of a line)



ARGUMENTS= \
		-order $(ORDER)  \
		-starter_size $(DEPTH) \
		-input_prefix STARTER_DIR/ \
		-output_prefix SYSTEMS/ \
		-solution_prefix SOLUTIONS/ \
		-base_fname Spreads_$(ORDER) \
		-recoordinatize \





all: starter lift build_db read_solutions compute_orbits isomorph report


# May 24, 2015 on MacBookPro 3 min 21 sec
# July 18, 2014 MacBook 3 min 38 sec





clean:
	- rm spread_$(ORDER)* report*  live_points* log*
	- rm -r ISO
	- rm PG_3_4*
	- rm -rf STARTER_DIR
	- rm -rf SOLUTIONS
	- rm -rf SYSTEMS
	- rm Fano_*
	- rm _tda*
	- rm system_*



cheat:
	$(PROJECTIVE_SPACE_PATH)/cheat_sheet_PG.out -n 3 -q 4
	pdflatex PG_3_4.tex
	open PG_3_4.pdf

full:
	- mkdir STARTER_DIR
	$(SPREAD_PATH)/spread_classify.out -v 6 -w \
		$(ARGUMENTS) \
		-starter \
		-starter_size $(ORDER_PLUS_ONE) 



#		-T -x 2300 -y 1000 \
#		-list




# Nov 17, 2009: 24 min 12 sec in fire.renci.org
# Feb 18, 2010 17 min 51 sec on MacBook
# Feb 21, 2010: 14 min 4 sec on MacBook
# Feb 21, 2010: 13 min 55 sec on MacBook
# Feb 22, 2010: 11 min 32 sec on MacBook
# Feb 22, 2010: 4 min 46 sec on MacBook
# June 20, 2011: 4 min 57 sec on MacBook
# Oct 8, 2011: 2 min 43 on MacBook (after correcting an error in translation_plane::check_function_incremental)
# 2/1/2013: 1 min 49 on domino
# MacBookPro March 16, 2016: 2 min 9 sec
# MacBookPro Nov 23, 2018: 48 sec


# 8 translation planes of order 16
# writes spread_16_2_stab_17_0.bin, ..., spread_16_2_stab_17_7.bin
#-1 8 22420 in 1:48(244800 = 2.4 x 10^5, 3600, 1728, 1008^2, 360, 288, 216)


vg_full:
	- mkdir STARTER_DIR
	valgrind --tool=callgrind \
		$(SPREAD_PATH)/spread_classify.out -v 6 -w \
		$(ARGUMENTS) \
		-starter \
		-starter_size $(ORDER_PLUS_ONE) \
		-T -x 2300 -y 1000 \
		-list



G0:
	$(ALGEBRA_PATH)/projective_group.out -v 2 -n 8 -q 2 -file spread_16_2_stab_17_0.bin



id:
	$(SPREAD_PATH)/spread_classify.out -v 2 -w -order $(ORDER) \
		-depth $(ORDER_PLUS_ONE) \
		-recoordinatize \
		-test_identify $(ORDER_PLUS_ONE) 100 


#tree_16:
#	$(TREEDRAW_PATH)/treedraw.out  -file spread_16_2_17.tree  
#	#-circle  -rad 20000
#	pdflatex spread_16_2_17.tex
#	open spread_16_2_17.pdf

tree_16:
	$(SEMIFIELD_PATH)/layered_graph_main.out -v 4 \
		-file spread_16_2_tree_lvl_17.layered_graph \
		-draw spread_16_2_tree_lvl_17 \
		-rad 90 \
		-embedded
		pdflatex spread_16_2_tree_lvl_17.tex
		open spread_16_2_tree_lvl_17.pdf 


draw17:
	$(SEMIFIELD_PATH)/layered_graph_main.out -v 4 \
		-file spread_16_2_tree_lvl_17.layered_graph \
		-draw TP16_tree \
		-xin 10000 -yin 10000 \
		-xout 800000 -yout 1100000 \
		-nodes_empty \
		-embedded
		pdflatex TP16_tree.tex
		open TP16_tree.pdf


draw:
	$(TREEDRAW_PATH)/treedraw.out -rad 3000 -on_circle -no_circletext -no_circle \
		-x 3300000 -y 1000000  \
		-file spread_16_2_17.tree
	mpost spread_16_2_17.mp

#$(TREEDRAW_PATH)/treedraw.out -on_circle -file graph_10_r3_g5_15.tree -graph 10 -rad 3000


#generator::draw_tree read treefile spread_16_2_17.tree with 22428 nodes
#written file spread_16_2_17.mp of size 5678460

#		-clique_level 5





starter:
	- mkdir STARTER_DIR
	$(SPREAD_PATH)/spread_classify.out -v 4 \
		$(ARGUMENTS) \
		-starter  -W \
		-T -x 2300 -y 1000 

starter_draw:
	$(SPREAD_PATH)/spread_classify.out -v 4 \
		$(ARGUMENTS) \
		-starter  -W \
		-T -x 2300 -y 1000 \
		-draw_poset

xx:
	$(TOOLS_PATH)/layered_graph_main.out -v 2 \
		-file STARTER_DIR/TP_$(ORDER)_poset_lvl_$(DEPTH).layered_graph \
		-draw TP_$(ORDER)_2_poset_lvl_$(DEPTH) \
		-xin 1000000 -yin 1000000 \
		-xout 1000000 -yout 1000000 \
		-y_stretch 1.1 \
		-rad 2000 \
		-nodes_empty \
		-embedded
	pdflatex TP_$(ORDER)_2_poset_lvl_$(DEPTH).tex
	open TP_$(ORDER)_2_poset_lvl_$(DEPTH).pdf




#generator::draw_poset writing file spread_16_2_aux_poset_lvl_5.layered_graph
#generator::draw_poset writing file spread_16_2_poset_lvl_5.layered_graph
#generator::draw_poset writing file spread_16_2_tree_lvl_5.layered_graph
#generator::draw_poset writing file spread_16_2_poset_detailed_lvl_5.layered_graph



draw5:
	$(TREEDRAW_PATH)/treedraw.out -no_circletext -no_circle -x 3300000 -y 1000000  spread_16_2_5.tree
	mpost spread_16_2_5.mp



starter4:
	$(SPREAD_PATH)/spread_classify.out -v 4 -order $(ORDER) \
		-depth 4 \
		-recoordinatize \
		-starter  -W 


print4:
	$(SPREAD_PATH)/spread_classify.out -v 4 -order $(ORDER) \
		-depth 4 \
		-recoordinatize \
		-print_representatives 4 spread_$(ORDER)_$(Q) 



lift:
	- mkdir SYSTEMS
	- mkdir SOLUTIONS
	$(SPREAD_PATH)/spread_classify.out -v 4 -order $(ORDER) \
		-lift $(DEPTH) ./ \
		$(ARGUMENTS) \
		-solve -save

#-lex 


# July 17, 2014 MacBook DEPTH=5 2 min 27 sec with 4064 solutions (with -lex)
# May 28, 2013 MacBook DEPTH=5 2 min 26 sec with 4067 solutions (with -lex)
# Juli 9, 2013 MacBook DEPTH=5 2 min 33 sec with 4064 solutions (with -lex)
# November 2, 2013 MacBook DEPTH=5 2 min 29 sec with 4064 solutions (with -lex)

#written file ./spread_16_2_depth_5_solutions.txt of size 440832
#total_solutions = 4064

#written file ./spread_16_2_depth_5_statistics.csv of size 482
#exact_cover::compute_liftings done

rainbow_0:
	$(TOOLS_PATH)/all_rainbow_cliques.out -v 2 \
		-file SYSTEMS/graph_0.bin \


draw_matrix_0:
	$(TOOLS_PATH)/draw_colored_graph.out -v 2 \
		-file SYSTEMS/system_0_Levi_graph.bin \
		-Levi 180 672 \
		-bitmatrix 
	mpost SYSTEMS/system_0_Levi_graph_bitmatrix.mp

#		-Levi_discrete

lift_0:
	$(SPREAD_PATH)/spread_classify.out -v 8 -order $(ORDER) \
		-lift $(DEPTH) ./ \
		-solve -lex \
		-save \
		-split 0 1000000 \
		-draw_system system_0
	pdflatex system_0_0.tex
	open system_0_0.pdf




#lift_0:
#	- mkdir LIFT_DATA
#	$(TRANSLATION_PLANE_PATH)/translation_plane_main.out -v 4 -order $(ORDER) \
#		-lift $(DEPTH) ./ \
#		-solve -lex \
#		-split 0 1000000 \
#		-draw_system LIFT_DATA/system

build_db:
	$(SPREAD_PATH)/spread_classify.out -v 2 \
		$(ARGUMENTS) \
		-build_db 


# July 17, 2014 MacBook 0 sec


read_solutions:
	$(SPREAD_PATH)/spread_classify.out -v 2 \
		$(ARGUMENTS) \
		-read_solutions

# July 17, 2014 MacBook 14 sec

compute_orbits:
	$(SPREAD_PATH)/spread_classify.out -v 4 \
		$(ARGUMENTS) \
		-compute_orbits 


# July 17, 2014 MacBook 7 sec

#isomorph::orbits_of_stabilizer finished, we found 150 orbits : 400^1, 300^2, 240^1, 160^1, 150^4, 120^3, 100^2, 80^5, 72^1, 60^5, 48^1, 40^2, 36^1, 24^2, 18^2, 16^2, 15^2, 12^6, 8^11, 6^9, 5^1, 4^27, 3^9, 2^18, 1^32


isomorph:
	$(SPREAD_PATH)/spread_classify.out -v 2  \
		$(ARGUMENTS) \
		-isomorph_testing  \
		-print_interval 250


# July 17, 2014 MacBook 32 sec
# May 28, 2013 MacBook DEPTH=5 37 sec with 8 isomorphism types


classification_graph:
	$(SPREAD_PATH)/spread_classify.out -v 2 -order $(ORDER) \
		-recoordinatize \
		-make_classification_graph $(DEPTH) 


report:
	$(SPREAD_PATH)/spread_classify.out -v 2 \
		$(ARGUMENTS) \
		-report
	pdflatex report_Spreads_$(ORDER).tex
	open report_Spreads_$(ORDER).pdf &


# July 17, 2014 MacBook 5 sec

quotients:
	$(SPREAD_PATH)/spread_classify.out -v 2 -order $(ORDER) \
		-recoordinatize \
		-depth $(DEPTH) \
		-make_quotients


Fano:
	$(SPREAD_PATH)/spread_classify.out -v 2 -order $(ORDER) \
		-Fano 
	
Fano0:
	$(ANDRE_PATH)/andre.out -v 2 -q $(Q) -k $(K) -no 0 -Fano \

# JOWK, ago=1008
# July 12, 2013 MacBook 0 min 12 sec 59 Fano

Fano1:
	$(ANDRE_PATH)/andre.out -v 2 -q $(Q) -k $(K) -no 1 -Fano \

# LMRH, ago=1008
# July 12, 2013 MacBook 0 min 12 sec 74 Fano

Fano2:
	$(ANDRE_PATH)/andre.out -v 2 -q $(Q) -k $(K) -no 2 -Fano \

# SEMI4
# July 12, 2013 MacBook 0 min 9 sec 53 Fano

Fano3:
	$(ANDRE_PATH)/andre.out -v 2 -q $(Q) -k $(K) -no 3 -Fano \

# DSFP, ago=216
# July 12, 2013 MacBook 0 min 32 sec 159 Fano

Fano4:
	$(ANDRE_PATH)/andre.out -v 2 -q $(Q) -k $(K) -no 4 -Fano \

# DEMP, ago=360
# July 12, 2013 MacBook 0 min 23 sec 111 Fano

Fano5:
	$(ANDRE_PATH)/andre.out -v 2 -q $(Q) -k $(K) -no 5 -Fano \

# SEMI2, ago=288
# July 12, 2013 MacBook 0 min 27 sec 146 Fano

Fano6:
	$(ANDRE_PATH)/andre.out -v 2 -q $(Q) -k $(K) -no 6 -Fano \

# HALL, ago=3600
# July 12, 2013 MacBook 0 min 6 sec 25 Fano

Fano7:
	$(ANDRE_PATH)/andre.out -v 2 -q $(Q) -k $(K) -no 7 -Fano \

# PG(2,16), ago=244800
# July 12, 2013 MacBook 0 min 4 sec 4 Fano



