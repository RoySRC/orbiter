MY_PATH=../../../DEV.14
#MY_PATH=/scratch/betten/COMPILE/2013_01_23
SRC=$(MY_PATH)/ORBITER/SRC
SRC2=$(MY_PATH)/ORBITER2/SRC2


BLT_PATH=$(SRC)/BLT
TOOLS_PATH=$(SRC)/TOOLS


Q=11
Q_PLUS_ONE=12
DEPTH=5
DEPTH_MINUS_ONE=4


all: starter the_graphs solve build_db read_solutions compute_orbits isomorph report pdf


clean:
	- rm BLT_$(Q)*
	- rm -rf GRAPHS ISO SOLUTIONS 
	- rm report_*

deep:
	$(BLT_PATH)/blt.out -v 5 -BLT -depth $(Q_PLUS_ONE) \
		-w -q $(Q) -starter -schreier $(Q_PLUS_ONE) \
		-draw_poset



draw:
	$(TOOLS_PATH)/layered_graph_main.out -v 2 \
		-file BLT_11_poset_lvl_$(Q_PLUS_ONE).layered_graph \
		-draw BLT_$(Q) \
		-xin 1000000 -yin 1000000 \
		-xout 1000000 -yout 1000000 \
		-y_stretch 1.1 \
		-rad 2000 \
		-nodes_empty \
		-embedded
	pdflatex BLT_$(Q).tex
	open BLT_$(Q).pdf


starter:
	$(BLT_PATH)/blt.out -v 5 -depth $(DEPTH) -W -BLT -q $(Q) -starter -schreier $(DEPTH) 


conv:
	/sw/bin/convert -density 600x600 -trim view.ps BLT_11_tree.png


the_graphs:
	- mkdir GRAPHS
	$(BLT_PATH)/blt.out -v 6 -BLT   -q $(Q) \
		-create_graphs $(DEPTH) 0 1 $(DEPTH_MINUS_ONE) \
		-lex \
		-output_prefix GRAPHS/




solve:
		- mkdir SOLUTIONS
		$(TOOLS_PATH)/all_cliques.out -v 2 \
			-list_of_cases GRAPHS/list_of_cases_BLT_$(Q)_$(DEPTH)_0_1.txt \
				GRAPHS/graph_BLT_$(Q)_$(DEPTH)_%ld.bin \
			-output_file SOLUTIONS/solutions_$(Q)_$(DEPTH)_all.txt 


#			-draw



build_db:
	$(BLT_PATH)/blt.out -v 1 -BLT -q $(Q) -build_db $(DEPTH)




read_solutions:
	$(BLT_PATH)/blt.out -v 2 -BLT -q $(Q) \
		-read_solution_files $(DEPTH) SOLUTIONS/solutions_$(Q)_$(DEPTH)_all.txt -1



compute_orbits:
	$(BLT_PATH)/blt.out -v 1 -BLT -q $(Q) \
		-compute_orbits $(DEPTH)


isomorph:
	$(BLT_PATH)/blt.out -v 2 -BLT -q $(Q) \
		-isomorph_testing $(DEPTH) \
		-print_interval 250



report:
	- $(BLT_PATH)/blt.out -v 1 -BLT -q $(Q) \
		-report $(DEPTH)

pdf:
	pdflatex report_BLT_$(Q).tex


down:
	$(BLT_PATH)/blt.out -v 2 \
		-BLT -q $(Q) \
		-down_orbits $(DEPTH)


sample:
	$(BLT_PATH)/sample.out -v 1 -BLT -q $(Q) -depth $(DEPTH) -number_of_trials 10 -lex -seed 1 \
		-out_prefix_graphs ./GRAPHS/ \
		-out_prefix_solutions ./SOLUTIONS/ 


classification_graph:
	$(BLT_PATH)/blt.out -v 2 \
		-BLT -q $(Q) \
		-make_classification_graph $(DEPTH) 

draw_decomp:
	cp ISO/decomposition_matrix.csv .
	$(TOOLS_PATH)/draw_matrix.out -csv decomposition_matrix.csv -fname_out decomp
	pdflatex decomp_bitmatrix.tex
	open decomp_bitmatrix.pdf

draw_classification_graph:
	cp ISO/classification_graph.layered_graph .
	$(TOOLS_PATH)/layered_graph_main.out -v 4 \
		-file classification_graph.layered_graph \
		-draw classification_graph \
		-rad 1000 \
		-xin 1000000 \
		-yin 1000000 \
		-xout 1000000 \
		-yout 1000000 \
		-embedded \
		-nodes_empty
	#mpost classification_graph.mp
	pdflatex classification_graph.tex
	open classification_graph.pdf


draw_graph:
	$(TOOLS_PATH)/draw_colored_graph.out -v 2 -file GRAPHS/graph_BLT_$(Q)_$(DEPTH)_0.bin -out_file graph -coordinates 1000000 1000000 500000 500000
	pdflatex graph_bitmatrix.tex
	open graph_bitmatrix.pdf



