MY_PATH=../../DEV.18/GITHUB/orbiter
MY_PATH2=../../DEV.18
#MY_PATH=/scratch2/betten/COMPILE/2017_11_29
SRC=$(MY_PATH)/ORBITER/SRC
SRC2=$(MY_PATH2)/ORBITER2/SRC2

PACKINGS_PATH=$(SRC2)/PACKINGS
REGULAR_PACKING_PATH=$(SRC2)/REGULAR_PACKING
GRASSMANN_PATH=$(SRC2)/GRASSMANN
TOOLS_PATH=$(SRC)/APPS/TOOLS
COMBINATORICS_PATH=$(SRC)/APPS/COMBINATORICS
PROJECTIVE_SPACE_PATH=$(SRC)/APPS/PROJECTIVE_SPACE


ORDER=16
Q=4
DEPTH=3
POLY=




ARGUMENTS= -order $(ORDER) -dim_over_kernel 2 -recoordinatize \
		-base_fname partial_packings_$(Q)_$(K)_ \
		-input_prefix ./STARTER_SPREADS/ \
		-output_prefix ./SYSTEMS/ \
		-solution_prefix ./SOLUTIONS/ \
		-starter_size $(DEPTH) 


##### new 12/31/17:

iso_test_packings:
	cp packing_q4_go2_g1_csz5_cno776923.packings_iso packing_q4_go2_g1_csz5_cno776923.packings_iso.csv
	$(PROJECTIVE_SPACE_PATH)/projective_space_main.out -v 2 -n 3 -q 4 \
		-file_of_packings_through_spread_table \
			packing_q4_go2_g1_csz5_cno776923.packings_iso.csv Spread_table.csv \
		-prefix PG_3_4_go2_g1_csz5_cno77623_packings \
		-save PG_3_4_go2_g1_csz5_cno77623_packings \
		-fixed_structure_of_element_of_order 2
	pdflatex PG_3_4_go2_g1_csz5_cno77623_packings_classification.tex
	open PG_3_4_go2_g1_csz5_cno77623_packings_classification.pdf



iso_test_packings22:
	cp packing_q4_go2_g1_csz5_cno776922.packings_iso packing_q4_go2_g1_csz5_cno776922.packings_iso.csv
	$(PROJECTIVE_SPACE_PATH)/projective_space_main.out -v 2 -n 3 -q 4 \
		-file_of_packings_through_spread_table \
			packing_q4_go2_g1_csz5_cno776922.packings_iso.csv Spread_table.csv \
		-prefix PG_3_4_go2_g1_csz5_cno77622_packings \
		-save PG_3_4_go2_g1_csz5_cno77622_packings \
		-fixed_structure_of_element_of_order 2
	pdflatex PG_3_4_go2_g1_csz5_cno77622_packings_classification.tex
	open PG_3_4_go2_g1_csz5_cno77622_packings_classification.pdf








classes:
	$(PACKINGS_PATH)/packing_main.out -v 6 $(ARGUMENTS) \
		-conjugacy_classes

# writes PGGL_4_4conjugacy_classes.magma



group_2_0:
	$(PACKINGS_PATH)/packing_main.out -v 6 $(ARGUMENTS) \
		-prime_at_a_time 2 0  


group_2_1:
	$(PACKINGS_PATH)/packing_main.out -v 6 $(ARGUMENTS) \
		-prime_at_a_time 2 1  



#i : type[i] : number of orbits
#0 : 1 : 5376
#1 : 2 : 691968

#We found 8 orbits of N on the set of short orbits
#8 orbits
#orbit group with 7 generators:
#i : orbit_first[i] : orbit_len[i]
#0 : 0 : 1920
#1 : 1920 : 1920
#2 : 3840 : 480
#3 : 4320 : 320
#4 : 4640 : 384
#5 : 5024 : 128
#6 : 5152 : 96
#7 : 5248 : 128

#Written file packing_q4_go2_g1_fixpoint_graph.bin of size 1849020
# Nov 26, 2017: 52:53 on tx1



cliques_5:
	$(TOOLS_PATH)/all_rainbow_cliques.out -v 2 \
		-file packing_q4_go2_g1_fixpoint_graph.bin \
		-no_colors 5 

# too many solutions!

#\
#		-export_magma



group_2_2:
	$(PACKINGS_PATH)/packing_main.out -v 6 $(ARGUMENTS) \
		-prime_at_a_time 2 2  

#			group_order = atoi(argv[++i]);
#			group_idx = atoi(argv[++i]);





c_2_1:
	$(PACKINGS_PATH)/packing_main.out -v 6 $(ARGUMENTS) \
		-cliques_on_fixpoint_graph 2 1 21


#			group_order = atoi(argv[++i]);
#			group_idx = atoi(argv[++i]);
#			clique_size = atoi(argv[++i]);


# Nov 27, 2017:  20 hrs 46 min on tx1, finds 776928 cliques at level 5 up to isomorphism under the normalizer


t:
	$(PACKINGS_PATH)/packing_main.out -v 6 $(ARGUMENTS) \
		-type_of_fixed_spreads 2 1 5


#			group_order = atoi(argv[++i]);
#			group_idx = atoi(argv[++i]);
#			clique_size = atoi(argv[++i]);





l_2_1:
	$(PACKINGS_PATH)/packing_main.out -v 6 $(ARGUMENTS) \
		-process_long_orbits 2 1 1 0 2 1


#group_order = atoi(argv[++i]);
#group_idx = atoi(argv[++i]);
#clique_size = atoi(argv[++i]);
#clique_no = atoi(argv[++i]);
#long_orbit_length = atoi(argv[++i]);
#long_orbits_clique_size = atoi(argv[++i]);


# Nov 27, 2017, 3:30:40 on Mac, writes packing_q4_go2_g1_1_0_2_longorbits_lvl_1


l_2:
	$(PACKINGS_PATH)/packing_main.out -v 6 $(ARGUMENTS) \
		-process_long_orbits 2 1 5 0 2 0

#Written file packing_q4_go2_g1_csz5_cno0.bin of size 57280061
#7:35

l:
	$(TOOLS_PATH)/all_rainbow_cliques.out -v 2 -file packing_q4_go2_g1_csz5_cno0.bin -all_cliques -no_colors 8 -solution_file -restrictions 0 0 512 -1 


NB_CASES=1024
NB_JOBS=1

parallel0:
	- mkdir SOLUTIONS
	cp packing_q4_go2_g1_csz5_cno0.bin SOLUTIONS/packing_q4_go2_g1_csz5_cno0.bin
	$(TOOLS_PATH)/scheduler.out \
		-v 2 \
		-input_file_mask SOLUTIONS/packing_q4_go2_g1_csz5_cno0.bin \
		-target_file_mask SOLUTIONS/packing_q4_go2_g1_csz5_cno0_case0_%ld_$(NB_CASES).success \
		-N $(NB_CASES) \
		-J $(NB_JOBS) \
		-command_mask  "$(TOOLS_PATH)/all_rainbow_cliques.out -v 2 -file SOLUTIONS/packing_q4_go2_g1_csz5_cno0.bin -all_cliques -no_colors 8 -solution_file -restrictions 0 %ld $(NB_CASES) -1 " \
		-reload \
		-log_prefix SOLUTIONS/ \
		-collate SOLUTIONS/packing_q4_go2_g1_csz5_cno0_case0_%ld_$(NB_CASES).solutions packing_q4_go2_g1_csz5_cno0.solutions



#CLIQUE_NO=776917
#CLIQUE_NO=776918
#CLIQUE_NO=776919
#CLIQUE_NO=776920
#CLIQUE_NO=776921
#CLIQUE_NO=776922
#CLIQUE_NO=776923
CLIQUE_NO=0

graph:
	$(PACKINGS_PATH)/packing_main.out -v 6 $(ARGUMENTS) \
		-process_long_orbits 2 1 5 $(CLIQUE_NO) 2 0

parallel:
	- mkdir SOLUTIONS
	cp packing_q4_go2_g1_csz5_cno$(CLIQUE_NO).bin SOLUTIONS/packing_q4_go2_g1_csz5_cno$(CLIQUE_NO).bin
	$(TOOLS_PATH)/scheduler.out \
		-define fname packing_q4_go2_g1_csz5_cno$(CLIQUE_NO) \
		-v 2 \
		-input_file_mask SOLUTIONS/XXXfnameXXX.bin \
		-target_file_mask SOLUTIONS/XXXfnameXXX_case0_%ld_$(NB_CASES).success \
		-N $(NB_CASES) \
		-J $(NB_JOBS) \
		-command_mask  "$(TOOLS_PATH)/all_rainbow_cliques.out -v 2 -file SOLUTIONS/XXXfnameXXX.bin -all_cliques -no_colors 8 -solution_file -restrictions 0 %ld $(NB_CASES) -1 " \
		-reload \
		-log_prefix SOLUTIONS/ \
		-collate SOLUTIONS/XXXfnameXXX_case0_%ld_$(NB_CASES).solutions XXXfnameXXX.solutions

read:
	$(PACKINGS_PATH)/packing_main.out -v 6 $(ARGUMENTS) \
		-process_long_orbits 2 1 5 $(CLIQUE_NO) 2 0


g:
	$(TOOLS_PATH)/colored_graph.out -file packing_q4_go2_g1_csz5_cno$(CLIQUE_NO).bin



#######

group_5_0:
	$(PACKINGS_PATH)/packing_main.out -v 6 $(ARGUMENTS) \
		-prime_at_a_time 5 0  -clique_size 5 -long_orbit_length 5

group_5_1:
	$(PACKINGS_PATH)/packing_main.out -v 6 $(ARGUMENTS) \
		-prime_at_a_time 5 1  -clique_size 5 -long_orbit_length 5

# 11/25/17 on Mac: 42 min 14 sec 

group_5_2:
	$(PACKINGS_PATH)/packing_main.out -v 6 $(ARGUMENTS) \
		-prime_at_a_time 5 2  -clique_size 5 -long_orbit_length 5

# 11/25/17 on Mac: 42 min 32 sec 


f0:
	$(TOOLS_PATH)/all_rainbow_cliques.out -v 2 -file packing_q4_g0_fixpoint_graph.bin -all_cliques  -solution_file -draw

# 48 vertices, no edges, 2 orbits on vertices: 48 = 36 + 12



f1:
	$(TOOLS_PATH)/all_rainbow_cliques.out -v 2 -file packing_q4_g1_fixpoint_graph.bin -all_cliques  -solution_file -draw

# 613 vertices, 50320 edges, 4 orbits on vertices: 613 = 68 + 136 + 408 + 1


f2:
	$(TOOLS_PATH)/all_rainbow_cliques.out -v 2 -file packing_q4_g2_fixpoint_graph.bin -all_cliques  -solution_file -draw

# 8 vertices, no edges, 2 orbits on vertices: 8=2+6







#-no_colors 4

c0:
	$(PACKINGS_PATH)/packing_main.out -v 6 $(ARGUMENTS) \
		-prime_at_a_time 0  -clique_size 1 -long_orbit_length 5 \
		-cliques_on_fixpoint_graph

# 2 orbits of cliques of size 1.


c1:
	$(PACKINGS_PATH)/packing_main.out -v 6 $(ARGUMENTS) \
		-prime_at_a_time 1  -clique_size 6 -long_orbit_length 5 \
		-cliques_on_fixpoint_graph


#depth : number of orbits
#0 : 1
#1 : 4
#2 : 6
#3 : 29
#4 : 136
#5 : 336
#6 : 482
#7 : 307
#8 : 62
#9 : 0

# We found 482 orbits of cliques of size 6 in the fixed point graph:




elt0:
	$(PACKINGS_PATH)/packing_main.out -v 6 $(ARGUMENTS) \
		-make_element 0

elt1:
	$(PACKINGS_PATH)/packing_main.out -v 6 $(ARGUMENTS) \
		-make_element 1

elt2:
	$(PACKINGS_PATH)/packing_main.out -v 6 $(ARGUMENTS) \
		-make_element 2


starter:
	- mkdir STARTER_SPREADS
	$(PACKINGS_PATH)/packing_main.out -v 6 $(ARGUMENTS) \
		-starter \
		-W


# using the double 5 (group of order 5)
#We found 1019780 orbits
#We found 78405 orbits which are partial packings
#There are 613 orbits of length 1 : 
#There are 77792 orbits of length 5 : 

#We found 418600 packings in case orbit 0
#writing packings to file packings_0.csv


c0_old:
	$(TOOLS_PATH)/all_rainbow_cliques.out -v 2 -file graph_0.bin -all_cliques -no_colors 4 -solution_file

# group of order 3600 / 36 = 100
# short orbit 0:
#The distribution of orbit lengths is: ( 5^16, 10^36, 20^20908 )
# 16 + 36 + 20908 = 20960
# nb x ago
# 12 x 20
# 36 x 10
# 20908 x 5

c1_old:
	$(TOOLS_PATH)/all_rainbow_cliques.out -v 2 -file graph_1.bin -all_cliques -no_colors 4 -solution_file

# May 2, 2016 MacBookPro 49 min 58 sec
# group of order 3600 / 12 = 300
#The distribution of orbit lengths is: ( 5^4, 10^2, 15^14, 20^12, 30^4, 60^6928 )
# 4 + 2 + 14 + 12 + 4 + 6928 = 6964
# nb x ago
# 4 x 50
# 2 x 30
# 14 x 20
# 12 x 25
# 4 x 10
# 6928 x 5

# total: 20960 + 6964 = 27924

type0:
	$(PACKINGS_PATH)/packing_main.out -v 6 $(ARGUMENTS) \
		-type_of_packing packings_iso_0.csv

type1:
	$(PACKINGS_PATH)/packing_main.out -v 6 $(ARGUMENTS) \
		-type_of_packing packings_iso_1.csv




